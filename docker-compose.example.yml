version: '3.8'

services:
  stackvo-tools:
    build:
      context: .
      dockerfile: Dockerfile
    image: stackvo/tools:latest # Tag for local built image
    container_name: stackvo-tools
    restart: unless-stopped

    labels:
      # Traefik global
      - "traefik.enable=true"
      - "traefik.docker.network=stackvo-net"

      # Adminer
      - "traefik.http.routers.adminer.rule=Host(`adminer.${BASE_DOMAIN:-stackvo.loc}`)"
      - "traefik.http.routers.adminer.entrypoints=websecure"
      - "traefik.http.routers.adminer.tls=true"
      - "traefik.http.routers.adminer.service=stackvo-tools"
      - "traefik.http.services.stackvo-tools.loadbalancer.server.port=80"

      # PhpMyAdmin
      - "traefik.http.routers.phpmyadmin.rule=Host(`phpmyadmin.${BASE_DOMAIN:-stackvo.loc}`)"
      - "traefik.http.routers.phpmyadmin.entrypoints=websecure"
      - "traefik.http.routers.phpmyadmin.tls=true"
      - "traefik.http.routers.phpmyadmin.service=stackvo-tools"

      # PhpPgAdmin
      - "traefik.http.routers.phppgadmin.rule=Host(`phppgadmin.${BASE_DOMAIN:-stackvo.loc}`)"
      - "traefik.http.routers.phppgadmin.entrypoints=websecure"
      - "traefik.http.routers.phppgadmin.tls=true"
      - "traefik.http.routers.phppgadmin.service=stackvo-tools"

      # PhpMongo
      - "traefik.http.routers.phpmongo.rule=Host(`phpmongo.${BASE_DOMAIN:-stackvo.loc}`)"
      - "traefik.http.routers.phpmongo.entrypoints=websecure"
      - "traefik.http.routers.phpmongo.tls=true"
      - "traefik.http.routers.phpmongo.service=stackvo-tools"

      # PhpMemcachedAdmin
      - "traefik.http.routers.phpmemcachedadmin.rule=Host(`phpmemcachedadmin.${BASE_DOMAIN:-stackvo.loc}`)"
      - "traefik.http.routers.phpmemcachedadmin.entrypoints=websecure"
      - "traefik.http.routers.phpmemcachedadmin.tls=true"
      - "traefik.http.routers.phpmemcachedadmin.service=stackvo-tools"

      # OpCache
      - "traefik.http.routers.opcache.rule=Host(`opcache.${BASE_DOMAIN:-stackvo.loc}`)"
      - "traefik.http.routers.opcache.entrypoints=websecure"
      - "traefik.http.routers.opcache.tls=true"
      - "traefik.http.routers.opcache.service=stackvo-tools"

      # Kafbat
      - "traefik.http.routers.kafbat.rule=Host(`kafbat.${BASE_DOMAIN:-stackvo.loc}`)"
      - "traefik.http.routers.kafbat.entrypoints=websecure"
      - "traefik.http.routers.kafbat.tls=true"
      - "traefik.http.routers.kafbat.service=stackvo-tools"

    volumes:
      # Persist installed tools (avoid re-downloading on restart)
      - tools-data:/var/www/html

    networks:
      - app-network

volumes:
  tools-data:
    driver: local

networks:
  app-network:
    external: true
    name: stackvo-net
